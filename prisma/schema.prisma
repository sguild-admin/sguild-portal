generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Organization {
  id                      String          @id @default(uuid()) @db.Uuid
  clerkOrgId              String          @unique
  name                    String
  primaryAdminClerkUserId String?
  createdAt               DateTime        @default(now())
  updatedAt               DateTime        @updatedAt
  members                 OrgMembership[]

  @@index([primaryAdminClerkUserId])
}

model AppUser {
  id           String   @id @default(uuid()) @db.Uuid
  clerkUserId  String   @unique
  isSuperAdmin Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model OrgMembership {
  id          String           @id @default(uuid()) @db.Uuid
  orgId       String           @db.Uuid
  clerkUserId String
  role        OrgRole
  status      MembershipStatus @default(INVITED)
  invitedAt   DateTime?
  activatedAt DateTime?
  disabledAt  DateTime?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  org         Organization     @relation(fields: [orgId], references: [id], onDelete: Cascade)

  @@unique([orgId, clerkUserId])
  @@index([clerkUserId])
  @@index([orgId, role, status])
}

model WebhookEvent {
  id          String    @id @default(uuid()) @db.Uuid
  provider    String
  eventId     String
  receivedAt  DateTime  @default(now())
  processedAt DateTime?

  @@unique([provider, eventId])
  @@index([provider, receivedAt])
}

enum OrgRole {
  ADMIN
  COACH
}

enum MembershipStatus {
  INVITED
  ACTIVE
  DISABLED
}
